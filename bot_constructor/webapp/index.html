<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SynapserAI ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{margin:0;background:#0f1115;color:#eaecef;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:800px;margin:0 auto;padding:20px}
    h1{font-size:24px;margin:16px 0 12px;text-align:center}
    .subtitle{text-align:center;opacity:.8;margin-bottom:24px}
    .card{background:#151821;border:1px solid #202534;border-radius:16px;padding:20px;margin:16px 0}
    .card h3{margin:0 0 16px 0;font-size:18px;color:#4b8cff}
    label{opacity:.9;font-size:14px;display:block;margin-bottom:8px}
    input,textarea,select{width:100%;margin-bottom:16px;padding:12px;border-radius:12px;border:1px solid #2a3142;background:#0f1320;color:#eaecef;box-sizing:border-box}
    textarea{min-height:100px;resize:vertical}
    button{border:0;background:#4b8cff;font-weight:600;cursor:pointer;padding:12px 24px;border-radius:12px;color:white;margin-right:12px;margin-bottom:12px}
    button:hover{background:#3a7ce8}
    button.secondary{background:#2a3142}
    button.secondary:hover{background:#3a4a5a}
    .muted{opacity:.75;font-size:13px;margin-top:8px}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .chip{padding:8px 16px;border:1px solid #2a3142;border-radius:999px;cursor:pointer;transition:all 0.2s}
    .chip:hover{background:#1f2940}
    .chip.active{background:#4b8cff;border-color:#4b8cff}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .col{flex:1;min-width:300px}
    .file-upload{position:relative;display:inline-block;cursor:pointer}
    .file-upload input[type=file]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}
    .file-upload-label{display:inline-block;padding:12px 24px;background:#2a3142;border-radius:12px;border:2px dashed #4b8cff;text-align:center;transition:all 0.2s}
    .file-upload:hover .file-upload-label{background:#3a4a5a;border-color:#5a9cff}
    .uploaded-files{margin-top:12px}
    .file-item{background:#1f2940;padding:8px 12px;border-radius:8px;margin:4px 0;display:flex;justify-content:space-between;align-items:center}
    .file-item .remove{color:#ff8182;cursor:pointer;padding:4px 8px;border-radius:4px}
    .file-item .remove:hover{background:#2a1f1f}
    .prompt-preview{background:#1f2940;border-radius:8px;padding:16px;margin:12px 0;border-left:4px solid #4b8cff}
    .actions{text-align:center;margin-top:32px}
    .save-btn{background:#7ee787;color:#0f1115;font-size:16px;padding:16px 32px}
    .save-btn:hover{background:#6dd676}
    .test-btn{background:#ffa726;color:#0f1115}
    .test-btn:hover{background:#ff9800}
    .integrations-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin:16px 0}
    .integration-card{background:#1f2940;border-radius:12px;padding:16px;border:1px solid #2a3142}
    .integration-card h4{margin:0 0 12px 0;color:#4b8cff}
    .integration-card input{margin-bottom:12px}
    .integration-card .description{font-size:13px;opacity:.8;margin-bottom:12px}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</h1>
  <div class="subtitle">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</div>
  <div id="msg" class="muted"></div>

  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <div class="card">
    <h3>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
    <div class="row">
      <div class="col">
        <label>–û–ø–∏—à–∏—Ç–µ –≤–∞—à –±–∏–∑–Ω–µ—Å</label>
        <textarea id="business" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ñ–µ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –∫–æ—Ñ–µ –ø–æ –ê–ª–º–∞—Ç—ã, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ —ç–ª–∏—Ç–Ω—ã—Ö —Å–æ—Ä—Ç–∞—Ö –∫–æ—Ñ–µ –∏ –¥–µ—Å–µ—Ä—Ç–∞—Ö"></textarea>
      </div>
      <div class="col">
        <label>–ß—Ç–æ –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç?</label>
        <textarea id="abilities" placeholder="–û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –º–µ–Ω—é, –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–∫–∞–∑—ã, —Å–æ–≤–µ—Ç–æ–≤–∞—Ç—å –∫–æ—Ñ–µ, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ –¥–æ—Å—Ç–∞–≤–∫–µ"></textarea>
      </div>
    </div>
    
    <label>–¢–æ–Ω –æ–±—â–µ–Ω–∏—è</label>
    <div class="chips" id="tones">
      <div class="chip active" data-v="–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π">üòä –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π</div>
      <div class="chip" data-v="–¥–µ–ª–æ–≤–æ–π">üíº –î–µ–ª–æ–≤–æ–π</div>
      <div class="chip" data-v="—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π">üéì –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π</div>
      <div class="chip" data-v="–∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π">üé® –ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π</div>
      <div class="chip" data-v="—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π">üìù –§–æ—Ä–º–∞–ª—å–Ω—ã–π</div>
    </div>
  </div>

  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
  <div class="card">
    <h3>üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h3>
    <label>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</label>
    <div class="muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOCX, XLSX, JPG, PNG</div>
    
    <div class="file-upload">
      <input type="file" id="file" multiple accept=".pdf,.docx,.xlsx,.jpg,.jpeg,.png"/>
      <label for="file" class="file-upload-label">üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</label>
    </div>
    
    <div id="uploaded-files" class="uploaded-files"></div>
    <div id="upload-status" class="muted"></div>
  </div>

  <!-- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç -->
  <div class="card">
    <h3>üß† –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç</h3>
    <label>–ü—Ä–æ–º–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫</label>
    <div id="prompt-preview" class="prompt-preview">
      <em>–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç" —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫</em>
    </div>
    <button onclick="generatePrompt()" class="secondary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç</button>
    <button onclick="editPrompt()" class="secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é</button>
  </div>

  <!-- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∫–∞–Ω–∞–ª–∞–º–∏ -->
  <div class="card">
    <h3>üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∫–∞–Ω–∞–ª–∞–º–∏</h3>
    <div class="integrations-grid">
      <!-- Telegram -->
      <div class="integration-card">
        <h4>üì± Telegram</h4>
        <div class="description">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞ –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</div>
        <label>Bot Token</label>
        <input type="text" id="telegram_token" placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"/>
        <label>Webhook Mode</label>
        <select id="telegram_webhook_mode">
          <option value="false">Polling (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)</option>
          <option value="true">Webhook (–ø—Ä–æ–¥–∞–∫—à–Ω)</option>
        </select>
        <div class="muted">Polling –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, Webhook –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞</div>
      </div>

      <!-- WhatsApp -->
      <div class="integration-card">
        <h4>üí¨ WhatsApp Business</h4>
        <div class="description">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ WhatsApp Business API –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</div>
        <label>Access Token</label>
        <input type="text" id="whatsapp_access_token" placeholder="EAA..."/>
        <label>Phone Number ID</label>
        <input type="text" id="whatsapp_phone_number_id" placeholder="123456789"/>
        <label>Verify Token</label>
        <input type="text" id="whatsapp_verify_token" placeholder="your_verify_token"/>
        <label>App Secret</label>
        <input type="text" id="whatsapp_app_secret" placeholder="your_app_secret"/>
        <div class="muted">–ü–æ–ª—É—á–∏—Ç–µ –≤ Meta Developer Console</div>
      </div>

      <!-- Instagram -->
      <div class="integration-card">
        <h4>üì∏ Instagram DM</h4>
        <div class="description">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ Instagram Direct Messages –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</div>
        <label>Access Token</label>
        <input type="text" id="instagram_access_token" placeholder="EAA..."/>
        <label>Business Account ID</label>
        <input type="text" id="instagram_business_account_id" placeholder="123456789"/>
        <label>Page ID</label>
        <input type="text" id="instagram_page_id" placeholder="123456789"/>
        <label>Verify Token</label>
        <input type="text" id="instagram_verify_token" placeholder="your_verify_token"/>
        <div class="muted">–¢—Ä–µ–±—É–µ—Ç Instagram Business Account</div>
      </div>
    </div>
    
    <div class="row" style="margin-top: 16px;">
      <button onclick="testChannels()" class="secondary">üß™ –¢–µ—Å—Ç –∫–∞–Ω–∞–ª–æ–≤</button>
      <button onclick="getWebhookUrls()" class="secondary">üîó –ü–æ–ª—É—á–∏—Ç—å Webhook URLs</button>
    </div>
  </div>
    </div>
    <button onclick="generatePrompt()" class="secondary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç</button>
    <button onclick="editPrompt()" class="secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é</button>
  </div>

  <!-- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ -->
  <div class="card">
    <h3>üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h3>
    <div class="integrations-grid">
      <div class="integration-card">
        <h4>üì± WhatsApp</h4>
        <div class="description">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WhatsApp Business API</div>
        <input id="wa_token" placeholder="Meta Access Token"/>
        <input id="wa_phone" placeholder="Phone Number ID"/>
      </div>
      
      <div class="integration-card">
        <h4>‚úàÔ∏è Telegram</h4>
        <div class="description">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –±–æ—Ç–∞</div>
        <input id="tg_token" placeholder="Bot Token (–µ—Å–ª–∏ —Å–≤–æ–π)"/>
      </div>
      
      <div class="integration-card">
        <h4>üì∏ Instagram Direct</h4>
        <div class="description">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Instagram</div>
        <input id="ig_app" placeholder="App ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"/>
      </div>
      
      <div class="integration-card">
        <h4>üåê –í–µ–±-—Å–∞–π—Ç</h4>
        <div class="description">–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ –≤–∞—à —Å–∞–π—Ç</div>
        <button onclick="getWidgetCode()" class="secondary">üìã –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
      </div>
    </div>
  </div>

  <!-- –î–µ–π—Å—Ç–≤–∏—è -->
  <div class="actions">
    <button onclick="saveAll()" class="save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <button onclick="testAssistant()" class="test-btn">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</button>
  </div>
</div>

<script>
  const tg = window.Telegram?.WebApp;
  tg?.expand();
  const initData = tg?.initData || "";

  const S = path => fetch(path, {method:"POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify({initData})}).then(r=>r.json());
  const P = (path, payload) => fetch(path, {method:"POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify({...payload, initData})}).then(r=>r.json());
  const G = path => fetch(path + "?initData=" + encodeURIComponent(initData)).then(r=>r.json());

  const $ = id => document.getElementById(id);
  let uploadedFiles = [];

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  (async () => {
    try {
      const v = await S("/api/verify");
      $("msg").textContent = "–ì–æ—Ç–æ–≤–æ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ";
      const saved = await G("/api/load_all");
      if (saved.business) $("business").value = saved.business;
      if (saved.abilities) $("abilities").value = saved.abilities;
      if (saved.tone) document.querySelectorAll("#tones .chip").forEach(c=>{
        c.classList.toggle("active", c.dataset.v===saved.tone);
      });
      if (saved.prompt) updatePromptPreview(saved.prompt);
      if (saved.integrations) loadIntegrations(saved.integrations);
    } catch(e) {
      $("msg").textContent = "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: " + (e.message || e);
    }
  })();

  // –í—ã–±–æ—Ä —Ç–æ–Ω–∞ –æ–±—â–µ–Ω–∏—è
  document.querySelectorAll("#tones .chip").forEach(chip=>{
    chip.onclick = () => {
      document.querySelectorAll("#tones .chip").forEach(c=>c.classList.remove("active"));
      chip.classList.add("active");
    };
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
  $("file").onchange = async (e) => {
    const files = Array.from(e.target.files);
    if (!files.length) return;
    
    $("upload-status").textContent = "–ó–∞–≥—Ä—É–∂–∞—é —Ñ–∞–π–ª—ã...";
    let ok = 0, fail = 0;
    
    for (const file of files) {
      try {
        const fd = new FormData();
        fd.append("initData", initData);
        fd.append("file", file);
        const res = await fetch("/api/upload_file", {method:"POST", body:fd});
        
        if (res.ok) {
          ok++;
          uploadedFiles.push({
            name: file.name,
            size: file.size,
            type: file.type
          });
        } else {
          fail++;
        }
      } catch(e) {
        fail++;
      }
    }
    
    updateUploadedFiles();
    $("upload-status").textContent = "–ó–∞–≥—Ä—É–∂–µ–Ω–æ: " + ok + ", –æ—à–∏–±–æ–∫: " + fail;
  };

  function updateUploadedFiles() {
    const container = $("uploaded-files");
    container.innerHTML = uploadedFiles.map(f => 
      '<div class="file-item">' +
        '<span>üìÑ ' + f.name + ' (' + (f.size/1024).toFixed(1) + 'KB)</span>' +
        '<span class="remove" onclick="removeFile(\'' + f.name + '\')">‚ùå</span>' +
      '</div>'
    ).join("");
  }

  function removeFile(name) {
    uploadedFiles = uploadedFiles.filter(f => f.name !== name);
    updateUploadedFiles();
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞
  async function generatePrompt() {
    try {
      const business = $("business").value.trim();
      const abilities = $("abilities").value.trim();
      const tone = document.querySelector("#tones .chip.active")?.dataset.v || "–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π";
      
      if (!business || !abilities) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞");
        return;
      }
      
      const r = await P("/api/generate_prompt", {business, abilities, tone});
      if (r.prompt) {
        updatePromptPreview(r.prompt);
      }
    } catch(e) {
      alert("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞: " + e.message);
    }
  }

  function updatePromptPreview(prompt) {
    $("prompt-preview").innerHTML = prompt.replace(/\n/g, '<br>');
  }

  function editPrompt() {
    const currentPrompt = $("prompt-preview").innerText;
    const newPrompt = prompt("–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç:", currentPrompt);
    if (newPrompt && newPrompt !== currentPrompt) {
      updatePromptPreview(newPrompt);
    }
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
  function loadIntegrations(integrations) {
    // Telegram
    if (integrations.telegram) {
      $("telegram_token").value = integrations.telegram.token || "";
      $("telegram_webhook_mode").value = integrations.telegram.webhook_mode || "false";
    }
    
    // WhatsApp
    if (integrations.whatsapp) {
      $("whatsapp_access_token").value = integrations.whatsapp.access_token || "";
      $("whatsapp_phone_number_id").value = integrations.whatsapp.phone_number_id || "";
      $("whatsapp_verify_token").value = integrations.whatsapp.verify_token || "";
      $("whatsapp_app_secret").value = integrations.whatsapp.app_secret || "";
    }
    
    // Instagram
    if (integrations.instagram) {
      $("instagram_access_token").value = integrations.instagram.access_token || "";
      $("instagram_business_account_id").value = integrations.instagram.business_account_id || "";
      $("instagram_page_id").value = integrations.instagram.page_id || "";
      $("instagram_verify_token").value = integrations.instagram.verify_token || "";
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
  async function saveAll() {
    try {
      const business = $("business").value.trim();
      const abilities = $("abilities").value.trim();
      const tone = document.querySelector("#tones .chip.active")?.dataset.v || "–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π";
      
      if (!business || !abilities) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è");
        return;
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      await P("/api/save_basics", {business, abilities});
      await P("/api/save_tone", {tone});
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
      const integrations = {
        telegram: {
          token: $("telegram_token").value,
          webhook_mode: $("telegram_webhook_mode").value === "true"
        },
        whatsapp: {
          access_token: $("whatsapp_access_token").value,
          phone_number_id: $("whatsapp_phone_number_id").value,
          verify_token: $("whatsapp_verify_token").value,
          app_secret: $("whatsapp_app_secret").value
        },
        instagram: {
          access_token: $("instagram_access_token").value,
          business_account_id: $("instagram_business_account_id").value,
          page_id: $("instagram_page_id").value,
          verify_token: $("instagram_verify_token").value
        }
      };
      await P("/api/save_integrations", {integrations});
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –µ—Å–ª–∏ –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω
      if ($("prompt-preview").innerText.includes("–ù–∞–∂–º–∏—Ç–µ")) {
        await generatePrompt();
      }
      
      alert("‚úÖ –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
    } catch(e) {
      alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + e.message);
    }
  }

  // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
  function testAssistant() {
    const business = $("business").value.trim();
    if (!business) {
      alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞");
      return;
    }
    
    const testUrl = "https://t.me/your_bot_username?start=test";
    if (tg?.openTelegramLink) {
      tg.openTelegramLink(testUrl);
    } else {
      alert("–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /ask –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è");
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è —Å–∞–π—Ç–∞
  function getWidgetCode() {
    const code = '<script src="https://your-domain.com/widget.js"></script>\n' +
                 '<div id="botcraft-widget" data-token="YOUR_TOKEN"></div>';
    
    if (tg?.showAlert) {
      tg.showAlert("–ö–æ–¥ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è:\n\n" + code);
    } else {
      alert("–ö–æ–¥ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è:\n\n" + code);
    }
  }

  // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
  async function testChannels() {
    try {
      const response = await fetch("/channels/status");
      const data = await response.json();
      
      if (data.ok) {
        let status = "üìä –°—Ç–∞—Ç—É—Å –∫–∞–Ω–∞–ª–æ–≤:\n\n";
        for (const [name, channel] of Object.entries(data.channels)) {
          const statusIcon = channel.active ? "‚úÖ" : "‚ùå";
          status += `${statusIcon} ${name}: ${channel.active ? "–∞–∫—Ç–∏–≤–µ–Ω" : "–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω"}\n`;
        }
        
        if (tg?.showAlert) {
          tg.showAlert(status);
        } else {
          alert(status);
        }
      } else {
        alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–Ω–∞–ª–æ–≤");
      }
    } catch(e) {
      alert("–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤: " + e.message);
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ Webhook URLs
  async function getWebhookUrls() {
    try {
      const response = await fetch("/channels/status");
      const data = await response.json();
      
      if (data.ok) {
        let urls = "üîó Webhook URLs –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:\n\n";
        for (const [name, channel] of Object.entries(data.channels)) {
          if (channel.config && channel.config.webhook_base_url) {
            const webhookUrl = channel.config.webhook_base_url + "/webhook/" + name;
            urls += `${name.toUpperCase()}: ${webhookUrl}\n`;
          }
        }
        
        if (tg?.showAlert) {
          tg.showAlert(urls);
        } else {
          alert(urls);
        }
      } else {
        alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è webhook URLs");
      }
    } catch(e) {
      alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è webhook URLs: " + e.message);
    }
  }
</script>
</body>
</html> 
